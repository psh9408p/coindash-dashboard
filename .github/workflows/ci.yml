name: CI Pipeline

# 1. 언제 실행할지 정의 (Trigger)
# main 브랜치로 push하거나 PR이 날아오면 실행
on:
    push:
        branches: ["main"]
    pull_request:
        branches: ["main"]

# 2. 실행할 작업 정의 (Jobs)
jobs:
    build:
        runs-on: ubuntu-latest # 리눅스 환경에서 실행

        strategy:
            matrix:
                node-version: [20.x] # Node.js 20 버전 사용

        steps:
            # (1) 코드 내려받기
            - name: Checkout Source Code
              uses: actions/checkout@v4

            # (2) Node.js 설치
            - name: Setup Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v4
              with:
                  node-version: ${{ matrix.node-version }}
                  cache: "npm" # npm 캐시 활성화 (속도 향상)

            # (3) 의존성 설치 (npm ci는 clean install로, lock파일 버전을 엄격하게 지킴)
            - name: Install Dependencies
              run: npm ci

            # (4) 린트 검사 (코드 스타일 오류 잡기)
            - name: Run Lint
              run: npm run lint

            # (5) 빌드 테스트 (타입 에러 + 빌드 오류 잡기)
            # Next.js의 build 명령은 내부적으로 타입 체크와 린트를 모두 수행함
            - name: Run Build
              run: npm run build
